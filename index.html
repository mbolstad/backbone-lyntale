<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>
        Backbone.js
    </title>
    <meta name="author" content="Mats Bolstad">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="css/custom.css" type="text/css">
    <link rel="stylesheet" href="css/reveal.css" type="text/css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme" type="text/css">
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css" type="text/css">
    <!-- If the query includes 'print-pdf', use the PDF print sheet -->

    <script type="text/javascript">
        document.write('<link rel="stylesheet" href="css/print/' + ( window.location.search.match(/print-pdf/gi) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">');
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>
<body>
<div class="reveal">
    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <h2>
                Fra kaos til struktur i JavaScript
            </h2>

            <img src="backbone-logo.png"/>

            <h3>
                Backbone.js
            </h3>

            <p>
                Mats Bolstad
            </p>
        </section>
        <section>
            <h2>
                Agenda
            </h2><br>
            <ul>
                <li>Mitt prosjekt med Backbone
                </li>
                <li>Motivasjon for MV*
                </li>
                <li>Introduksjon Backbone
                </li>
                <li>Hvilke problemer løser Backbone?
                </li>
                <li style="list-style: none; display: inline">
                    <ul class="smaller">
                        <li>og hvilke løser den <em>ikke</em>?
                        </li>
                    </ul>
                </li>
            </ul>
        </section>
        <section>
            <section>
                <h2>
                    Erfaring fra prosjekt
                </h2><br>

                <div class="left">
                    <p>
                        SpareBank1 - Saksbehandlingsverktøy for mislighold
                    </p><br>

                    <p>
                        <strong>Omfang:</strong>
                    </p>
                    <ul>
                        <li>5 utviklere
                        </li>
                        <li>4 måneder
                        </li>
                    </ul>
                    <br>
                </div>
            </section>
            <section>
                <h2>
                    Erfaring fra prosjekt
                </h2><br/>

                <p class="bigger">
                    Én statisk HTML-side. REST-arkitektur.
                </p><br>

                <div class="left">
                    <ul>
                        <li>
                            <em>Front-end:</em> Backbone.js, jQuery, Require.js, Bootstrap
                        </li>
                        <li>
                            <span class="muted"><em>Back-end:</em> Java ++</span>
                        </li>
                    </ul>
                </div>
            </section>
        </section>
        <section>
            <section>
                <h2>
                    Motivasjon?
                </h2>
                <br>

                <p>Holder det ikke med jQuery?</p>
            </section>

<script data-template="org1" type="text/template">
    <h4>Enkelt skjema</h4>

    <form id="foo">
        <input type="text">
        <input type="submit">
    </form>
</script>
            <section>
                <h3>Eksempel</h3>

                <p>En webapp som utvider seg "organisk":</p>

                <div class="block" data-template="org1">
                </div>

                <pre><code data-template="org1" data-escape>
                </code></pre>

            </section>

            <section>
                <p>Krav 1:</p>
                <blockquote>Man skal kunne trykke <strong>Send</strong> bare når det er data i feltet.
                </blockquote>
            </section>

            <section>
                <div class="block" data-template="org1">
                </div>

                <pre><code data-template="org1" data-escape>
                </code></pre>

                <pre><code>
    $("#foo [type=text]").on("change", function () {
        if ($(this).val().length > 0) {
            $("#foo [type=submit]").show();
        } else {
            $("#foo [type=submit]").hide();
        }
    });
                </code></pre>
            </section>

            <section>
                <p>Krav 2:</p>
                <blockquote>URL-en skal reflektere søket brukeren utfører.</blockquote>
            </section>

            <section>
                <pre><code>
    $("#foo").on("submit", function () {
        var søkeStreng = $("#foo [type=text]").val();

        $.ajax({
            url:"http://foo.no",
            type:"get",
            data:søkeStreng,
            success:function (data) {
                window.history.replaceState(søkeStreng); // (sic)

                // Håndter respons ...
            }
        });
    });
                </code></pre>
            </section>

            <section>
                <p>Krav 3:</p>
                <blockquote>Søkeresultat må vises i tabell. <br/>Feilmelding må vises hvis søket feilet.</blockquote>
            </section>

<script data-template="js3" type="text/javascript">
    $("#foo").on("submit", function () {
        var søkeStreng = $("#foo [type=text]").val();

        $.ajax({
            url:"http://foo.no",
            type:"get",
            data:søkeStreng,
            error:function (error) {
                $("#feilmeldingsboks").text(error);
            },
            success:function (data) {
                window.history.pushState(søkeStreng);

                var tabellModell = JSON.parse(data);

                $("#resultatTabell").empty();
                tabellModell.forEach(function (x) {
                    var rad = "<tr><td>" + x.navn + "</td></tr>";
                    $("#resultatTabell").append(rad);
                });
            }
        });
    });
</script>

            <section>
                <pre><code style="max-height: 600px" data-template="js3" data-escape>
                </code></pre>
            </section>

            <section>
                <img src="spaghetti.jpg">
            </section>

            <section>
                <h2>Sterk kobling</h2>
                <div class="left">

                <p>Her skjer:</p>
                <ul class="smaller">
                    <li>Henting av verdi fra DOM</li>
                    <li>Sending av request</li>
                    <li>Ivaretaelse av tilstand (URL)</li>
                    <li>Parsing av respons</li>
                    <li>Tegning av view</li>
                </ul>
                <br/>
                <br/>
                <p class="fragment"><em>Det behøver ikke bli slik, men det har veldig lett for det.</em></p>
                </div>
            </section>

            <!-- <section>

                <p>JavaScript eller jQuery er ikke problemet her.</p>
                <br>
                <p>Problemet er mangel på <em><strong>separering av concerns</strong></em>.</p>

            </section> -->

        </section>

        <section>
            <h2>MV*-rammeverk</h2>

            <div class="spacer"></div>
            <div class="grid">
                <div class="col-1-2">
                    <ul>
                        <li>Backbone.js</li>
                        <li>Ember.js</li>
                        <li>AngularJS</li>
                        <li>Spine</li>
                        <li>KnockoutJS</li>
                        <li>Dojo</li>
                    </ul>
                </div>
                <div class="col-1-2">
                    <ul>
                        <li>YUI</li>
                        <li>Batman.js</li>
                        <li>Closure</li>
                        <li>Agility.js</li>
                        <li>Knockback.js</li>
                        <li>Google Web Toolkit</li>
                    </ul>
                </div>
            </div>
            <div class="spacer"></div>
            <p class="smaller">Implementasjoner av disse på: <em>todomvc.com</em></p>
        </section>

        <section>
            <section>
                <h2>Backbone.js</h2>
                <div class="spacer"></div>
                <ul class="hanging">
                    <li>Stor grad av frihet, må bestemme konvensjoner selv. <ul><li>Backbone only, no flesh</li> </ul> </li>
                    <li>Lite: <ul><li>6.3KB</li><li>~ 1500 kodelinjer</li></ul></li>
                </ul> 
            </section>

            <section>
                <h2>Backbone.js</h2>
                <div class="spacer"></div>
                <ul class="hanging">
                    <li>"Hard" avhengighet til Underscore.js <ul> <li>Funksjonell programmering</li><li>+ Templates</li></ul></li>
                    <li>"Myk" avhengighet til jQuery <ul> <li>DOM-manipulering</li></ul></li>
                </ul>
            </section>

            <section>
                <h3>Backbone's "vaskelapp":</h3>
                <br>
                <blockquote class="highlight-strong">
Backbone.js gives structure to web applications by providing <strong>models</strong> with key-value binding and custom events, <strong>collections</strong> with a rich API of enumerable functions, <strong>views</strong> with declarative event handling, and connects it all to your existing API over a RESTful JSON interface.
                </blockquote>
            </section>
        </section>
        <section>
            <section>
                <h3>Komponenter</h3>
                <div class="spacer"></div>
                <code>
                    <ul>
                        <li>Backbone.Model</li>
                        <li>Backbone.Collection</li>
                        <div class="small-spacer"></div>
                        <li>Backbone.View</li>
                        <div class="small-spacer"></div>
                        <li>Backbone.Router</li>
                    </ul>
                </code>
            </section>
        </section>

        <section>
            <section>
                <h2>Backbone.Model</h2>

                <div class="spacer"></div>

                <ol>
                    <li>Definerer REST-endpoints</li>
                </ol>

                <div class="spacer"></div>
                
                <pre><code>
    var TweetModel = Backbone.Model.extend({
        urlRoot: "https://api.twitter.com/1/statuses/show"
    });
                </code></pre>

                <pre><code>
    var model = new TweetModel();
    model.fetch();       // GET
    model.save();        // POST/PUT 
    model.destroy();     // DELETE
                </code></pre>

            </section>

            <section>
                <h2>Backbone.Model</h2>

                <div class="spacer"></div>

                <ol start="2">
                    <li>Gettere og settere (som trigger eventer)</li>
                </ol>

                <br>
                
                <pre><code>
    model.on("change", function() {
        console.log(model.get("text"));
    });
                </code></pre>

                <pre><code>
    model.set("text", "foobar");
    // printer "foobar"
                </code></pre>
            </section>

            <section>
                <h2>Backbone.Model</h2>

                <div class="spacer"></div>

                <ol start="3">
                    <li>... eventuelt andre ting</li>
                </ol>

                <br>

                <pre><code>
 var Beer = Backbone.Model.extend({
    isLightBeer: function() {
      return this.get("alcohol") >= 2 && this.get("alcohol") <= 3;
    }
 });
                </code></pre>
            </section>
        </section>

        <section>
            <h2>Backbone.Collection</h2>

            <div class="spacer"></div>

            <p>Samling av <code>Backbone.Model</code>-er</p>
            <div class="spacer"></div>

            <pre><code>
    var BeerCase = Backbone.Collection.extend({
        model: Beer
    });

    var beerCase = new BeerCase();
    
    var myBeers = beerCase.reject(function(beer) {
        return beer.isLightBeer();
    });
            </code></pre>
        </section>

        <section>
            
            <section>

                <h2>Backbone.View</h2>
                <div class="spacer"></div>
                <ul class="hanging">
                    <li>Ansvar for et subtre i DOM-en <ul> <li>Rendrer modeller</li> </ul> </li>
                    <li>Mapper DOM-eventer til semantiske eventer <ul> <li>Manipulerer modeller</li> </ul></li>
                </ul>

                <div class="spacer"></div>
                <p class="muted">
                    Får veldig lite fra rammeverket.
                </p>

            </section>

            <section>
                <pre><code style="max-height: 700px;">
var DocumentRow = Backbone.View.extend({

    tagName: "li",

    events: {
        "click .icon":          "open",
        "click .button.delete": "destroy"
    },

    initialize: function() {
        this.model.on("change", this.render);
    },

    render: function() {
        this.$el.html( <span class="code-comment">template</span> );
    }

});                
                </code></pre>
            </section>

        </section>
        <section>
            <section>
                <h2>Backbone.Router</h2>

                <div class="spacer"></div>

                <ul class="hanging">
                    <li>Håndterer tilstand i applikasjonen.
                        <ul>
                            <li>Lytter på endringer i URL.</li>
                            <li>Parser URL-ruter.</li>
                            <li>Kan manipulere URL-en.</li>
                        </ul>
                    </li>
                    <li>Vil typisk initialisere Views, og sende med parametre.</li>
                </ul>
            </section>

            <section>
                <pre><code style="max-height: 500px;">
    Backbone.Router.Extend({
        routes: {
            "/show/:itemId": "show",
            "/edit/:itemId": "edit"
        },

        show: function(itemId) {
            var view = new ShowView(itemId);
            view.render();
        },

        edit: function(itemId) {
            var view = new EditView(itemId);
            view.render();
        }
    });
                </code></pre>
                <div class="fragment">
                    <p>For å lagre tilstand:</p>
                    <code><pre>
    router.navigate("/show/123", true);
                    </code></pre>

                </div>

            </section>
        </section>

        <section>
            <section>
                <p class="bigger"><strong>Hva løses <em>ikke</em> av Backbone?</strong></p>
                <div class="spacer"></div>
                <p>Nøstede modeller</p>
<pre><code>
    {
        name: "Mats",
        address: {
            street: "Veien",
            number: 1
        }
    }
</code></pre>  
            </section>
            <section>
                <p class="bigger"><strong>Hva løses <em>ikke</em> av Backbone?</strong></p>
                <div class="spacer"></div>
                <p>Nøstede views</p>
<pre><code>
    // Kan gjøre det slik, eller ikke
    var SuperView = Backbone.View.extend({

        // ...

        render: function() {
            this.subView1.render();
            this.subView2.render();

            this.$el.empty();
            this.$el.append(this.subView1.$el);
            this.$el.append(this.subView2.$el);
        }
    });
</code></pre>
            </section>

            <section>
                <p class="bigger"><strong>Hva løses <em>ikke</em> av Backbone?</strong></p>
                <div class="spacer"></div>
                <p>2-veis bindinger mellom DOM og modell</p>
<pre><code style="max-height: 600px;">
var SomeView = Backbone.View.extend({

  // Oppsett

  events: {
    "change input#name": this.updateName
  },

  initialize: function() {
    this.model.on("change:name", this.renderName);
  },


  // Utførelse

  renderName: function() {
    this.$("#name").val(this.model.get("name"));
  },

  updateName: function() {
    this.model.set("name", this.$("#name").val());
  }
});
</code></pre>
            </section>
        </section>

        <section>
            <h2>Et vell av plugins</h2>
            
            <div class="grid smaller3">
                <div class="col-1-3">
                    <ul>
                        <li>Backbone Forms</li>
                        <li>backbone-deep-model</li>
                        <li>Backbone-Nested</li>
                        <li>Backbone.Memento</li>
                        <li>Backbone.Validation</li>
                        <li>Backbone.Validator</li>
                        <li>Backbone.ModelRef</li>
                        <li>workflow.js</li>
                        <li>Backbone.Mutators</li>
                        <li>Backbone.Chosen</li>
                        <li>Backbone.Schema</li>
                        <li>Backbone.localStorage</li>
                    </ul>
                </div>
                <div class="col-1-3">
                    <ul>
                        <li>Backbone-slet</li>
                        <li>Backbone.SharePoint</li>
                        <li>Backbone.SAP</li>
                        <li>Backbone.Offline</li>
                        <li>Backbone.Rpc</li>
                        <li>Backbone.Safe</li>
                        <li>Backbone.Rel</li>
                        <li>Ligament</li>
                        <li>backbone-orm</li>
                        <li>backbone-pageable</li>
                        <li>Nesting.js</li>
                        <li>LayoutManager</li>
                    </ul>
                </div>
                <div class="col-1-3">
                    <ul>
                        <li>Backbone.ViewEvents</li>
                        <li>Backbone.Subviews</li>
                        <li>Backbone.Stickit</li>
                        <li>Synapse</li>
                        <li>Backbone.ModelBinding</li>
                        <li>Knockback.js </li>
                        <li>Backbone on the Couch</li>
                        <li>ProxyDollar</li>
                        <li>Backbone.declarative</li>
                        <li>outback.js</li>
                        <li>Backbone.ViewKit</li>
                        <li>Backrub</li>
                    </ul>
                </div>
            </div>

            <p>+++</p>

        </section>

        <section>
            <h2>Lett å teste</h2>
            <div class="spacer"></div>
            <ul>
                <li>Enhetstesting med Jasmine.js</li>
                <li>Sinon for å fake HTTP</li>
            </ul>
            <br>
            <pre><code>
    it("should search and render result", function () {
        
        server.respondWith("GET", "/api/name-search", [
            '{"name":"Ola Normann", "address":"Veien"}'
        ]);

        var myView = new MyView();
        myView.$("#name").trigger("change", "ola");
        
        expect(myView.$("#result")).toHaveText("Ola Normann");
      
    });
            </code></pre>
        </section>

        <section>
            <h2>Oppsummert</h2>
            <div class="spacer"></div>
            
            <div class="left">
                <ul>
                    <li>JavaScript har lett for å bli neglisjert</li>
                </ul>
                <div class="spacer"></div>
                
                <ul class="hanging">
                    <li>Backbone: Lavterskeltilbud for struktur</li>
                    <li>Backbone: Langt fra fullstack
                        <ul>
                            <li>Må bestemme deg for konvensjoner</li>
                            <li>Bra utvalg av plugins</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </section>

        <section>
            <br><br>
            <h2>
                Takk for meg
            </h2>
            
            <div class="spacer"></div>

            <p><a href="http://mbolstad.github.com/backbone-lyntale">http://mbolstad.github.com/backbone-lyntale</a></p>
        
            <div class="spacer"></div>            

            <p class="smaller muted">Slideshow: <code>reveal.js</code></p>
        </section>
    </div>
</div>
<script src="lib/js/head.min.js" type="text/javascript"></script>
<script src="js/reveal.min.js" type="text/javascript"></script>
<script src="js/jquery-1.9.1.js" type="text/javascript"></script>
<script src="js/templating.js" type="text/javascript"></script>
<script type="text/javascript">

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls:true,
        progress:true,
        history:true,

        theme:'default', // available themes are in /css/theme
        transition:'linear', // default/cube/page/concave/zoom/linear/none

        // Optional libraries used to extend on reveal.js
        dependencies:[
            { src:'lib/js/classList.js', condition:function () {
                return !document.body.classList;
            } },
            { src:'plugin/markdown/showdown.js', condition:function () {
                return !!document.querySelector('[data-markdown]');
            } },
            { src:'plugin/markdown/markdown.js', condition:function () {
                return !!document.querySelector('[data-markdown]');
            } },
            { src:'plugin/highlight/highlight.js', async:true, callback:function () {
                hljs.initHighlightingOnLoad();
            } },
            { src:'plugin/zoom-js/zoom.js', async:true, condition:function () {
                return !!document.body.classList;
            } },
            { src:'plugin/notes/notes.js', async:true, condition:function () {
                return !!document.body.classList;
            } }
        ]
    });

</script>
</body>
</html>